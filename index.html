<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Snake Game | SnowMan YT</title>

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#050b1a;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  touch-action: none; /* Prevents mobile scrolling while playing */
}
canvas{display:block}
#footer{
  position:fixed;
  bottom:10px;
  width:100%;
  text-align:center;
  color:#aaa;
  font-size:13px;
  pointer-events: none;
}
#ui{
  position:fixed;
  top:15px;
  right:15px;
  display: flex;
  gap: 10px;
  align-items: center;
}
#score-board {
  color: #00ffd5;
  font-weight: bold;
  font-size: 20px;
  text-shadow: 0 0 10px rgba(0, 255, 213, 0.5);
}
button{
  background:#00ffd5;
  border:none;
  padding:6px 14px;
  border-radius:20px;
  cursor:pointer;
  font-weight:600;
  transition: transform 0.1s;
}
button:active { transform: scale(0.95); }
</style>
</head>

<body>

<canvas id="game"></canvas>

<div id="ui">
  <div id="score-board">Score: 0</div>
  <button onclick="toggleSound()">ðŸ”Š Sound</button>
</div>

<div id="footer">Game developed by @ SnowMan YT</div>

<audio id="bgm" loop src="https://cdn.pixabay.com/audio/2022/03/15/audio_2e4a89d5c3.mp3"></audio>
<audio id="eatSound" src="https://cdn.pixabay.com/audio/2022/03/10/audio_6f8c61d3f2.mp3"></audio>
<audio id="bossAppearSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_8d06b67fa4.mp3"></audio>
<audio id="bossEatSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_9c0cfe7d65.mp3"></audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreElement = document.getElementById("score-board");

let snake=[], dir={x:1,y:0}, speed=3;
let food={}, bossFood=null, foodCount=0, bossTimer=0;
let soundOn=false;
let score = 0;
let gameOver = false;

const bgm=document.getElementById("bgm");
const eatSound=document.getElementById("eatSound");
const bossAppearSound=document.getElementById("bossAppearSound");
const bossEatSound=document.getElementById("bossEatSound");

bgm.volume=0.35;
eatSound.volume=bossAppearSound.volume=bossEatSound.volume=0.6;

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

function toggleSound(){
  soundOn=!soundOn;
  if(soundOn){
    bgm.play().catch(()=>{});
  }else{
    bgm.pause();
  }
}

function playSFX(s){
  if(soundOn){
    s.currentTime=0;
    s.play().catch(()=>{});
  }
}

function initGame() {
  snake = [];
  dir = {x:1, y:0};
  score = 0;
  foodCount = 0;
  gameOver = false;
  scoreElement.innerText = `Score: ${score}`;
  for(let i=0;i<20;i++){
    snake.push({x:canvas.width/2-i*10, y:canvas.height/2, wrap:false});
  }
  spawnFood();
}

function spawnFood(){
  food={x:Math.random()*(canvas.width-40)+20, y:Math.random()*(canvas.height-40)+20};
}

function spawnBossFood(){
  bossFood={x:Math.random()*(canvas.width-40)+20, y:Math.random()*(canvas.height-40)+20};
  bossTimer=400; 
  playSFX(bossAppearSound);
}

function setDir(x,y){
  // Prevent 180-degree turns
  if(x===-dir.x && y===-dir.y) return;
  dir={x,y};
}

// CONTROLS
document.addEventListener("keydown",e=>{
  if(gameOver) { initGame(); return; }
  if(e.key==="ArrowUp") setDir(0,-1);
  if(e.key==="ArrowDown") setDir(0,1);
  if(e.key==="ArrowLeft") setDir(-1,0);
  if(e.key==="ArrowRight") setDir(1,0);
});

let touchStart=null;
canvas.addEventListener("touchstart",e=>{
  if(gameOver) initGame();
  touchStart=e.touches[0];
}, {passive: false});

canvas.addEventListener("touchend",e=>{
  if(!touchStart) return;
  const t=e.changedTouches[0];
  const dx=t.clientX-touchStart.clientX;
  const dy=t.clientY-touchStart.clientY;
  if(Math.abs(dx) > 10 || Math.abs(dy) > 10) {
    Math.abs(dx)>Math.abs(dy) ? setDir(dx>0?1:-1,0) : setDir(0,dy>0?1:-1);
  }
});

function update(){
  if(gameOver) return;

  const head = snake[0];
  let x = head.x + dir.x * speed;
  let y = head.y + dir.y * speed;
  let wrapped = false;

  // Screen Wrap Logic
  if(x<0){x+=canvas.width; wrapped=true;}
  if(y<0){y+=canvas.height; wrapped=true;}
  if(x>canvas.width){x-=canvas.width; wrapped=true;}
  if(y>canvas.height){y-=canvas.height; wrapped=true;}

  // Self-Collision Check (ignore the first 25 segments to allow for movement)
  for(let i=25; i<snake.length; i++){
    if(Math.hypot(x-snake[i].x, y-snake[i].y) < 8){
      gameOver = true;
      return;
    }
  }

  snake.unshift({x,y,wrap:wrapped});
  snake.pop();

  // Eat Food
  if(Math.hypot(x-food.x,y-food.y)<22){
    for(let i=0; i<3; i++) snake.push({...snake.at(-1)});
    score += 10;
    foodCount++;
    scoreElement.innerText = `Score: ${score}`;
    playSFX(eatSound);
    spawnFood();
    if(foodCount % 5 === 0) spawnBossFood();
  }

  // Boss Food Logic
  if(bossFood){
    bossTimer--;
    if(Math.hypot(x-bossFood.x,y-bossFood.y)<28){
      for(let i=0;i<15;i++) snake.push({...snake.at(-1)});
      score += 100;
      scoreElement.innerText = `Score: ${score}`;
      bossFood=null;
      playSFX(bossEatSound);
    }
    if(bossTimer<=0) bossFood=null;
  }
}

function drawSnake(){
  ctx.lineWidth=18;
  ctx.lineJoin=ctx.lineCap="round";

  // Use a fixed gradient style to prevent flickering during wraps
  const grad=ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
  grad.addColorStop(0,"#00ffd5");
  grad.addColorStop(1,"#0055ff");
  ctx.strokeStyle=grad;

  ctx.beginPath();
  ctx.moveTo(snake[0].x,snake[0].y);

  for(let i=1;i<snake.length;i++){
    if(snake[i].wrap){
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(snake[i].x,snake[i].y);
    } else {
      ctx.lineTo(snake[i].x,snake[i].y);
    }
  }
  ctx.stroke();

  // Head
  const h=snake[0];
  ctx.fillStyle="#00ffe1";
  ctx.beginPath();
  ctx.arc(h.x,h.y,12,0,Math.PI*2);
  ctx.fill();

  // Eyes
  const a=Math.atan2(dir.y,dir.x);
  ctx.fillStyle="#fff";
  for(let s of [-1,1]){
    ctx.beginPath();
    ctx.arc(
      h.x+Math.cos(a+0.5*s)*7,
      h.y+Math.sin(a+0.5*s)*7,
      3,0,Math.PI*2
    );
    ctx.fill();
  }
}

function draw(){
  ctx.fillStyle = "#050b1a";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  if(gameOver){
    ctx.fillStyle = "white";
    ctx.textAlign = "center";
    ctx.font = "bold 40px system-ui";
    ctx.fillText("GAME OVER", canvas.width/2, canvas.height/2);
    ctx.font = "20px system-ui";
    ctx.fillText(`Final Score: ${score}`, canvas.width/2, canvas.height/2 + 40);
    ctx.font = "16px system-ui";
    ctx.fillStyle = "#aaa";
    ctx.fillText("Press any key or Tap to Restart", canvas.width/2, canvas.height/2 + 80);
    return;
  }

  // Draw Regular Food
  ctx.fillStyle="#ff4757";
  ctx.shadowBlur=15;
  ctx.shadowColor="#ff4757";
  ctx.beginPath();
  ctx.arc(food.x,food.y,8,0,Math.PI*2);
  ctx.fill();

  // Draw Boss Food
  if(bossFood){
    ctx.fillStyle="#ffd700";
    ctx.shadowBlur=20;
    ctx.shadowColor="#ffd700";
    ctx.beginPath();
    ctx.arc(bossFood.x,bossFood.y,16,0,Math.PI*2);
    ctx.fill();
    ctx.shadowBlur=0;
    ctx.fillStyle="#fff";
    ctx.font="bold 14px monospace";
    ctx.textAlign="center";
    ctx.fillText(Math.ceil(bossTimer/60),bossFood.x,bossFood.y-25);
  }
  
  ctx.shadowBlur=0; // Reset shadow for snake
  drawSnake();
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

initGame();
loop();
</script>

</body>
</html>